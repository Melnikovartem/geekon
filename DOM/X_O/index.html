<html>
  <head>
    <title>X_O</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="my.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  </head>
  <body>
    <div class = "container">
      <div class = "row">
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
      </div>
      <div class = "row">
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
      </div>
      <div class = "row">
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
        <div class = "col-4 place"> <img src = "X.png"><img src = "O.png"></div>
      </div>
      <div class = "row">
        <div class = "menu col-2">Active: <div id = "active"><div></div><img src = "X.png"><img src = "O.png"></div></div>
        <div class = "menu col"><button class='btn btn-outline-danger' id = "reset">Reset</button><h1 id = "score"><h1></div>
      </div>
      <div class = "row">
        <div class = "menu col"><h1 class = "winner">Winner is X!<h1><h1 class = "winner">Winner is O!<h1><h1 class = "winner">No winner! Draw!<h1></div></div>
      </div>
      <div class = "footer fixed-bottom">
        <button class='btn btn-outline-danger' id = "reset_score">New Game</button>
      <div>
    </div>
    <script>
      var empty = "000000000";
      if(!window.localStorage.game)
        window.localStorage.game = empty;
      if(!window.localStorage.active)
        window.localStorage.active = 1;
      if(!window.localStorage.win_O)
        window.localStorage.win_O = 0;
      if(!window.localStorage.win_X)
        window.localStorage.win_X = 0;
      if(!window.localStorage.draw)
        window.localStorage.draw = 0;
      window.localStorage.winner = 0;

      var place = document.getElementsByClassName("place");
      update();
      function a(i){
        return function(){
          if(!place[i].classList.contains("full") && !place[i].classList.contains("finished")){
            str = window.localStorage.game;
            window.localStorage.game = str.substr(0,i) + window.localStorage.active + str.substr(i+1);
            window.localStorage.active = window.localStorage.active==1?2:1;
            check();
            if(window.localStorage.winner != 0){
              winned();
            }
            update();
          }
        }
      }
      function winned(){
        for(var i = 0; i<place.length; i++){
          place[i].classList.add("full");
        }
        document.getElementsByClassName("winner")[window.localStorage.winner-1].style.display = "block";
        if(window.localStorage.winner == 1)
          window.localStorage.win_X ++;
        else if(window.localStorage.winner == 2)
          window.localStorage.win_O ++;
        else
          window.localStorage.draw ++;
      }
      function update(){
        for(var i = 0; i<place.length; i++){
          if(window.localStorage.game[i]){
            if(window.localStorage.game[i] != 0)
              place[i].childNodes[window.localStorage.game[i]].style.display = "block";
            else {
              place[i].childNodes[1].style.display = "none";
              place[i].childNodes[2].style.display = "none";
            }
          }
          if(window.localStorage.game[i]!=0)
            place[i].classList.add("full");
          document.getElementById("active").childNodes[window.localStorage.active].style.display = "block";
          document.getElementById("active").childNodes[window.localStorage.active==1?2:1].style.display = "none"
        }
        document.getElementById("score").innerHTML = "Score -> X:Draw:O -> " + window.localStorage.win_X + ":" + window.localStorage.draw + ":" + window.localStorage.win_O;
      }
      function reset(){
        for(var i = 0; i<place.length; i++)
          place[i].classList.remove("full");
        window.localStorage.game = empty;
        window.localStorage.active = 1;
        for(var i =0; i<3; i++)
          document.getElementsByClassName("winner")[i].style.display = "none";
        window.localStorage.winner = 0;
        update();
      }

      function reset_score(){
        window.localStorage.win_O = 0;
        window.localStorage.win_X = 0;
        window.localStorage.draw = 0;
        reset();
      }

      function check(){
        var i,j,a,ans;
        var data = window.localStorage.game;
        //check lines
          for(i=0; i<9; i+=3){
            a = [];
            for(j=i; j<i+3; j++)
              a.push(data[j]);
            if(a[0] == a[1] && a[1] == a[2] && a[0] != "0")
              window.localStorage.winner = a[0];
          }
        //check rows
          for(i=0; i<3; i++){
            a = [];
            for(j=i; j<9; j+=3)
              a.push(data[j]);
            if(a[0] == a[1] && a[1] == a[2] && a[0] != "0")
              window.localStorage.winner = a[0];
          }

        //check other
          a = [data[0], data[4], data[8]];
          if(a[0] == a[1] && a[1] == a[2] && a[0] != "0")
            window.localStorage.winner = a[0];
          a = [data[2], data[4], data[6]];
          if(a[0] == a[1] && a[1] == a[2] && a[0] != "0")
            window.localStorage.winner = a[0];

          if(window.localStorage.winner == 0 && data.indexOf("0") == -1)
            window.localStorage.winner = 3;
      }
      document.getElementById("reset").addEventListener('click', function(){return reset()});
      document.getElementById("reset_score").addEventListener('click', function(){return reset_score()});
      for(var i = 0; i<place.length; i++){
        place[i].addEventListener('click', a(i));
      }
    </script>
  </body>
</html>
